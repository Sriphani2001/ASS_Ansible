global
    log         127.0.0.1 local2
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon
    stats socket /var/lib/haproxy/stats

defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    timeout connect         5000
    timeout client          50000
    timeout server          50000

frontend http-in
    bind *:80
    mode http
    default_backend app-backend

backend app-backend
    mode http
    balance roundrobin
        stats enable
        stats uri /haproxy?stats
        balance roundrobin
        {% for host in groups["webservers"] %}
        server {{ host }} {{ hostvars[host].ansible_default_ipv4.address}}:5000 check
{% endfor %}


backend app-backend
    mode http
    balance roundrobin
    server  deva  {{ hostvars['deva'].ansible_all_ipv4_addresses }}:5000
    server  devb  {{ hostvars['devb'].ansible_all_ipv4_addresses }}:5000
    server  devc  {{ hostvars['devc'].ansible_all_ipv4_addresses }}:5000
